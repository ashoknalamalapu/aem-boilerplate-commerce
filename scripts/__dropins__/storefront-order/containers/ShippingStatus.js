import{jsxs as u,jsx as n,Fragment as x}from"@dropins/tools/preact-jsx-runtime.js";import{classes as $,Slot as o}from"@dropins/tools/lib.js";import{Card as E,Header as L,Accordion as w,AccordionSection as G,ContentGrid as J,Image as M}from"@dropins/tools/components.js";import"../chunks/OrderCancelReasonsForm.js";import{u as Q}from"../chunks/ReturnOrder.js";import{useState as X,useEffect as Z}from"@dropins/tools/preact-hooks.js";import{events as Y}from"@dropins/tools/event-bus.js";import{u as R}from"../chunks/useIsMobile.js";import{Text as U,useText as k}from"@dropins/tools/i18n.js";import{C as P}from"../chunks/OrderLoaders.js";import"@dropins/tools/preact-compat.js";import"@dropins/tools/preact.js";var H=(p=>(p.PENDING="pending",p.SHIPPING="shipping",p.COMPLETE="complete",p.PROCESSING="processing",p.HOLD="on hold",p.CANCELED="Canceled",p.SUSPECTED_FRAUD="suspected fraud",p.PAYMENT_REVIEW="payment review",p))(H||{});const D=({orderData:p})=>{const[c,i]=X(p);return Z(()=>{const g=Y.on("order/data",s=>{i(s)},{eager:!0});return()=>{g==null||g.off()}},[]),{order:c}},nn=({slots:p,collapseThreshold:c,translations:i,orderReturn:g,routeReturnDetails:s,routeOrderDetails:m,routeTracking:b,routeProductDetails:C})=>{const I=R();if(!(g!=null&&g.length))return null;const T=C!=null&&C()?"a":"span";return u(E,{variant:"secondary",className:$(["order-shipping-status-card","order-shipping-status-card--return-order"]),children:[n(L,{title:i.returnOrderCardTitle}),g==null?void 0:g.map((h,j)=>{var v;const a=h.items,d=(h==null?void 0:h.returnNumber)??"",N=(h==null?void 0:h.orderNumber)??"",O=(h==null?void 0:h.token)??"",_=(s==null?void 0:s({returnNumber:d,orderNumber:N,token:O}))??"#",t=(m==null?void 0:m({orderNumber:N,token:O}))??"#";return u("div",{children:[u("p",{children:[i.returnNumber," ",n("a",{href:_,rel:"noreferrer",children:h.returnNumber})]}),u("p",{children:[i.orderNumber," ",n("a",{href:t,rel:"noreferrer",children:h.orderNumber})]}),(v=h==null?void 0:h.tracking)==null?void 0:v.map((f,l)=>{var e,S;return u("p",{children:[`${i.carrier} ${(S=(e=f==null?void 0:f.carrier)==null?void 0:e.label)==null?void 0:S.toLocaleUpperCase()}: `,n("a",{href:`${(b==null?void 0:b(f))??"#"}`,rel:"noreferrer",children:f.trackingNumber})]},`${f.trackingNumber}_${l}`)}),p!=null&&p.ReturnItemsDetails?n(o,{"data-testid":"returnItemsDetails",name:"ReturnItemsDetails",slot:p==null?void 0:p.ReturnItemsDetails,context:{items:a}}):null,n(w,{actionIconPosition:"right","data-testid":"dropinAccordion",children:n(G,{defaultOpen:c>=(a==null?void 0:a.length),title:n(U,{id:"Order.ShippingStatusCard.itemText",plural:a==null?void 0:a.length,fields:{count:a==null?void 0:a.length}}),children:n(J,{maxColumns:I?3:9,emptyGridContent:n(x,{}),className:$(["order-shipping-status-card__images",["order-shipping-status-card__images-3",I]]),children:a==null?void 0:a.map((f,l)=>{var y,r;const e=(y=f.thumbnail)==null?void 0:y.label,S=(r=f.thumbnail)==null?void 0:r.url;return n(T,{href:(C==null?void 0:C(f))??"#","data-testid":`${l}${f.uid}`,children:n(M,{alt:e,src:S,width:85,height:114})},`${l}${f.uid}`)})})})})]},j)})]})},pn=({translations:p,slots:c,orderData:i,collapseThreshold:g=10,routeProductDetails:s,routeReturnDetails:m,routeOrderDetails:b,routeTracking:C})=>{var N,O,_,t,v,f;const I=Q(),T=s?"a":"span",h=(N=i==null?void 0:i.status)==null?void 0:N.toLocaleLowerCase(),a=((O=i==null?void 0:i.shipments)==null?void 0:O.length)===1&&(h==null?void 0:h.includes(H.COMPLETE)),d=(_=i==null?void 0:i.items)==null?void 0:_.filter(l=>(l==null?void 0:l.quantityShipped)===0);if(I&&((t=i==null?void 0:i.returns)!=null&&t.length)){const l=i==null?void 0:i.returns;return n(nn,{slots:c,collapseThreshold:g,translations:p,orderReturn:l,routeReturnDetails:m,routeOrderDetails:b,routeTracking:C,routeProductDetails:s})}return!i||h!=null&&h.includes(H.CANCELED)?null:(v=i==null?void 0:i.shipments)!=null&&v.length?u(x,{children:[(f=i==null?void 0:i.shipments)==null?void 0:f.map(({tracking:l,items:e,id:S},y)=>u(E,{variant:"secondary",className:"order-shipping-status-card",children:[n(L,{title:p.shippingCardTitle}),l==null?void 0:l.map(r=>{var A;return u("div",{className:"order-shipping-status-card__header",role:"status",children:[u("div",{className:"order-shipping-status-card__header--content",children:[u("p",{children:[p.carrier," ",(A=r==null?void 0:r.carrier)==null?void 0:A.toLocaleUpperCase()," | ",r==null?void 0:r.number]}),n("p",{children:r==null?void 0:r.title})]}),c!=null&&c.DeliveryTrackActions?n(o,{"data-testid":"deliverySlotActions",name:"DeliveryTrackActions",slot:c==null?void 0:c.DeliveryTrackActions,context:{trackInformation:r}}):null]},r.number)}),a?null:n(w,{actionIconPosition:"right","data-testid":"dropinAccordion",children:n(G,{"data-position":y+1,defaultOpen:g>=(e==null?void 0:e.length),title:n(x,{children:n(U,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:e==null?void 0:e.length,fields:{count:e==null?void 0:e.length}})}),children:n(J,{maxColumns:6,emptyGridContent:n(x,{}),className:"order-shipping-status-card__images",children:e==null?void 0:e.map(r=>{var F,q,V,W,z,B;const A=(V=(q=(F=r==null?void 0:r.orderItem)==null?void 0:F.product)==null?void 0:q.thumbnail)==null?void 0:V.label,K=(B=(z=(W=r==null?void 0:r.orderItem)==null?void 0:W.product)==null?void 0:z.thumbnail)==null?void 0:B.url;return n(T,{href:(s==null?void 0:s(r))??"#",children:n(M,{alt:A,src:K||"",width:85,height:114})},r.id)})})})}),c!=null&&c.DeliveryTimeLine?n(o,{"data-testid":"deliverySlotTimeLine",name:"DeliveryTimeLine",slot:c==null?void 0:c.DeliveryTimeLine,context:{}}):null]},S)),d!=null&&d.length?u(E,{variant:"secondary",className:"order-shipping-status-card","data-testid":"dropinAccordionNotYetShipped2",children:[n(L,{title:p.notYetShippedTitle}),n(w,{actionIconPosition:"right",children:n(G,{defaultOpen:g>=(d==null?void 0:d.length),title:n(U,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:d==null?void 0:d.length,fields:{count:d==null?void 0:d.length}}),children:n("div",{className:"order-shipping-status-card__images",children:d==null?void 0:d.map(l=>{var e,S;return n(T,{href:(s==null?void 0:s(l))??"#",children:n(M,{alt:(e=l.thumbnail)==null?void 0:e.label,src:((S=l.thumbnail)==null?void 0:S.url)||"",width:85,height:114})},l.id)})})})})]}):null]}):u(E,{variant:"secondary",className:"order-shipping-status-card",children:[n(L,{title:p.shippingInfoTitle}),n("div",{className:"order-shipping-status-card__header",children:u("div",{className:"order-shipping-status-card__header--content",children:[i!=null&&i.carrier?n("p",{children:i==null?void 0:i.carrier}):null,n("p",{children:p.noInfoTitle})]})})]})},Sn=({slots:p,className:c,collapseThreshold:i,orderData:g,routeProductDetails:s,routeReturnDetails:m,routeOrderDetails:b,routeTracking:C})=>{const{order:I}=D({orderData:g}),T=k({carrier:"Order.ShippingStatusCard.carrier",prepositionOf:"Order.ShippingStatusCard.prepositionOf",returnOrderCardTitle:"Order.ShippingStatusCard.returnOrderCardTitle",shippingCardTitle:"Order.ShippingStatusCard.shippingCardTitle",shippingInfoTitle:"Order.ShippingStatusCard.shippingInfoTitle",notYetShippedTitle:"Order.ShippingStatusCard.notYetShippedTitle",noInfoTitle:"Order.ShippingStatusCard.noInfoTitle",returnNumber:"Order.ShippingStatusCard.returnNumber",orderNumber:"Order.ShippingStatusCard.orderNumber"});return n("div",{className:$(["order-shipping-status",c]),children:I?n(pn,{translations:T,routeProductDetails:s,routeReturnDetails:m,routeOrderDetails:b,routeTracking:C,slots:p,orderData:I,collapseThreshold:i}):n(P,{withCard:!1})})};export{Sn as ShippingStatus,Sn as default};
