/*! Copyright 2024 Adobe
All Rights Reserved. */
import{jsxs as C,jsx as i,Fragment as E}from"@dropins/tools/preact-jsx-runtime.js";import{classes as t,Slot as w}from"@dropins/tools/lib.js";import{Card as L,Header as $,Accordion as G,AccordionSection as M,ContentGrid as K,Image as U}from"@dropins/tools/components.js";import"../chunks/OrderCancelReasonsForm.js";import{useState as X,useEffect as Z}from"@dropins/tools/preact-hooks.js";import{events as o}from"@dropins/tools/event-bus.js";import{u as Y}from"../chunks/useIsMobile.js";import{Text as H,useText as R}from"@dropins/tools/i18n.js";import{C as k}from"../chunks/OrderLoaders.js";import"@dropins/tools/preact-compat.js";import"@dropins/tools/preact.js";var j=(p=>(p.PENDING="pending",p.SHIPPING="shipping",p.COMPLETE="complete",p.PROCESSING="processing",p.HOLD="on hold",p.CANCELED="Canceled",p.SUSPECTED_FRAUD="suspected fraud",p.PAYMENT_REVIEW="payment review",p))(j||{});const P=({orderData:p})=>{const[c,n]=X(p);return Z(()=>{const g=o.on("order/data",s=>{n(s)},{eager:!0});return()=>{g==null||g.off()}},[]),{order:c}},D=({slots:p,collapseThreshold:c,translations:n,orderReturn:g,routeReturnDetails:s,routeOrderDetails:b,routeTracking:m,routeProductDetails:a})=>{const I=Y();if(!(g!=null&&g.length))return null;const N=a!=null&&a()?"a":"span";return C(L,{variant:"secondary",className:t(["order-shipping-status-card","order-shipping-status-card--return-order"]),children:[i($,{title:n.returnOrderCardTitle}),g==null?void 0:g.map((r,F)=>{var v;const f=r.items,d=(r==null?void 0:r.returnNumber)??"",T=(r==null?void 0:r.orderNumber)??"",O=(r==null?void 0:r.token)??"",_=(s==null?void 0:s({returnNumber:d,orderNumber:T,token:O}))??"#",y=(b==null?void 0:b({orderNumber:T,token:O}))??"#";return C("div",{children:[C("p",{children:[n.returnNumber," ",i("a",{href:_,rel:"noreferrer",children:r.returnNumber})]}),C("p",{children:[n.orderNumber," ",i("a",{href:y,rel:"noreferrer",children:r.orderNumber})]}),(v=r==null?void 0:r.tracking)==null?void 0:v.map((u,l)=>{var e,S;return C("p",{children:[`${n.carrier} ${(S=(e=u==null?void 0:u.carrier)==null?void 0:e.label)==null?void 0:S.toLocaleUpperCase()}: `,i("a",{href:`${(m==null?void 0:m(u))??"#"}`,rel:"noreferrer",children:u.trackingNumber})]},`${u.trackingNumber}_${l}`)}),p!=null&&p.ReturnItemsDetails?i(w,{"data-testid":"returnItemsDetails",name:"ReturnItemsDetails",slot:p==null?void 0:p.ReturnItemsDetails,context:{items:f}}):null,i(G,{actionIconPosition:"right","data-testid":"dropinAccordion",children:i(M,{defaultOpen:c>=(f==null?void 0:f.length),title:i(H,{id:"Order.ShippingStatusCard.itemText",plural:f==null?void 0:f.length,fields:{count:f==null?void 0:f.length}}),children:i(K,{maxColumns:I?3:9,emptyGridContent:i(E,{}),className:t(["order-shipping-status-card__images",["order-shipping-status-card__images-3",I]]),children:f==null?void 0:f.map((u,l)=>{var A,h;const e=(A=u.thumbnail)==null?void 0:A.label,S=(h=u.thumbnail)==null?void 0:h.url;return i(N,{href:(a==null?void 0:a(u))??"#","data-testid":`${l}${u.uid}`,children:i(U,{alt:e,src:S,width:85,height:114})},`${l}${u.uid}`)})})})})]},F)})]})},nn=({translations:p,slots:c,orderData:n,collapseThreshold:g=10,routeProductDetails:s,routeReturnDetails:b,routeOrderDetails:m,routeTracking:a})=>{var T,O,_,y,v,u;const I=n==null?void 0:n.returnNumber,N=s?"a":"span",r=(T=n==null?void 0:n.status)==null?void 0:T.toLocaleLowerCase(),f=((O=n==null?void 0:n.shipments)==null?void 0:O.length)===1&&(r==null?void 0:r.includes(j.COMPLETE)),d=(_=n==null?void 0:n.items)==null?void 0:_.filter(l=>(l==null?void 0:l.quantityShipped)===0);if(I&&((y=n==null?void 0:n.returns)!=null&&y.length)){const l=n==null?void 0:n.returns;return i(D,{slots:c,collapseThreshold:g,translations:p,orderReturn:l,routeReturnDetails:b,routeOrderDetails:m,routeTracking:a,routeProductDetails:s})}return!n||r!=null&&r.includes(j.CANCELED)?null:(v=n==null?void 0:n.shipments)!=null&&v.length?C(E,{children:[(u=n==null?void 0:n.shipments)==null?void 0:u.map(({tracking:l,items:e,id:S},A)=>C(L,{variant:"secondary",className:"order-shipping-status-card",children:[i($,{title:p.shippingCardTitle}),l==null?void 0:l.map(h=>{var x;return C("div",{className:"order-shipping-status-card__header",role:"status",children:[C("div",{className:"order-shipping-status-card__header--content",children:[C("p",{children:[p.carrier," ",(x=h==null?void 0:h.carrier)==null?void 0:x.toLocaleUpperCase()," | ",h==null?void 0:h.number]}),i("p",{children:h==null?void 0:h.title})]}),c!=null&&c.DeliveryTrackActions?i(w,{"data-testid":"deliverySlotActions",name:"DeliveryTrackActions",slot:c==null?void 0:c.DeliveryTrackActions,context:{trackInformation:h}}):null]},h.number)}),f?null:i(G,{actionIconPosition:"right","data-testid":"dropinAccordion",children:i(M,{"data-position":A+1,defaultOpen:g>=(e==null?void 0:e.length),title:i(E,{children:i(H,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:e==null?void 0:e.length,fields:{count:e==null?void 0:e.length}})}),children:i(K,{maxColumns:6,emptyGridContent:i(E,{}),className:"order-shipping-status-card__images",children:e==null?void 0:e.map(h=>{var q,V,W,z,B,J;const x=(W=(V=(q=h==null?void 0:h.orderItem)==null?void 0:q.product)==null?void 0:V.thumbnail)==null?void 0:W.label,Q=(J=(B=(z=h==null?void 0:h.orderItem)==null?void 0:z.product)==null?void 0:B.thumbnail)==null?void 0:J.url;return i(N,{href:(s==null?void 0:s(h))??"#",children:i(U,{alt:x,src:Q||"",width:85,height:114})},h.id)})})})}),c!=null&&c.DeliveryTimeLine?i(w,{"data-testid":"deliverySlotTimeLine",name:"DeliveryTimeLine",slot:c==null?void 0:c.DeliveryTimeLine,context:{}}):null]},S)),d!=null&&d.length?C(L,{variant:"secondary",className:"order-shipping-status-card","data-testid":"dropinAccordionNotYetShipped2",children:[i($,{title:p.notYetShippedTitle}),i(G,{actionIconPosition:"right",children:i(M,{defaultOpen:g>=(d==null?void 0:d.length),title:i(H,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:d==null?void 0:d.length,fields:{count:d==null?void 0:d.length}}),children:i("div",{className:"order-shipping-status-card__images",children:d==null?void 0:d.map(l=>{var e,S;return i(N,{href:(s==null?void 0:s(l))??"#",children:i(U,{alt:(e=l.thumbnail)==null?void 0:e.label,src:((S=l.thumbnail)==null?void 0:S.url)||"",width:85,height:114})},l.id)})})})})]}):null]}):C(L,{variant:"secondary",className:"order-shipping-status-card",children:[i($,{title:p.shippingInfoTitle}),i("div",{className:"order-shipping-status-card__header",children:C("div",{className:"order-shipping-status-card__header--content",children:[n!=null&&n.carrier?i("p",{children:n==null?void 0:n.carrier}):null,i("p",{children:p.noInfoTitle})]})})]})},Cn=({slots:p,className:c,collapseThreshold:n,orderData:g,routeProductDetails:s,routeReturnDetails:b,routeOrderDetails:m,routeTracking:a})=>{const{order:I}=P({orderData:g}),N=R({carrier:"Order.ShippingStatusCard.carrier",prepositionOf:"Order.ShippingStatusCard.prepositionOf",returnOrderCardTitle:"Order.ShippingStatusCard.returnOrderCardTitle",shippingCardTitle:"Order.ShippingStatusCard.shippingCardTitle",shippingInfoTitle:"Order.ShippingStatusCard.shippingInfoTitle",notYetShippedTitle:"Order.ShippingStatusCard.notYetShippedTitle",noInfoTitle:"Order.ShippingStatusCard.noInfoTitle",returnNumber:"Order.ShippingStatusCard.returnNumber",orderNumber:"Order.ShippingStatusCard.orderNumber"});return i("div",{className:t(["order-shipping-status",c]),children:I?i(nn,{translations:N,routeProductDetails:s,routeReturnDetails:b,routeOrderDetails:m,routeTracking:a,slots:p,orderData:I,collapseThreshold:n}):i(k,{withCard:!1})})};export{Cn as ShippingStatus,Cn as default};
