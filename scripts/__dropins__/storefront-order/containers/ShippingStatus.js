/*! Copyright 2024 Adobe
All Rights Reserved. */
import{jsxs as a,jsx as i,Fragment as E}from"@dropins/tools/preact-jsx-runtime.js";import{classes as w,Slot as G}from"@dropins/tools/lib.js";import{Card as L,Header as $,Accordion as M,AccordionSection as U,ContentGrid as Q,Image as H}from"@dropins/tools/components.js";import"../chunks/OrderCancelReasonsForm.js";import{useState as Z,useEffect as Y}from"@dropins/tools/preact-hooks.js";import{events as t}from"@dropins/tools/event-bus.js";import{u as R}from"../chunks/useIsMobile.js";import{Text as j,useText as o}from"@dropins/tools/i18n.js";import{C as k}from"../chunks/OrderLoaders.js";import"@dropins/tools/preact-compat.js";import"@dropins/tools/preact.js";var F=(p=>(p.PENDING="pending",p.SHIPPING="shipping",p.COMPLETE="complete",p.PROCESSING="processing",p.HOLD="on hold",p.CANCELED="Canceled",p.SUSPECTED_FRAUD="suspected fraud",p.PAYMENT_REVIEW="payment review",p))(F||{});const P=({orderData:p})=>{const[e,n]=Z(p);return Y(()=>{const s=t.on("order/data",d=>{n(d)},{eager:!0});return()=>{s==null||s.off()}},[]),{order:e}},D=({slots:p,collapseThreshold:e,translations:n,orderReturn:s,routeReturnDetails:d,routeOrderDetails:b,routeTracking:m,routeProductDetails:u})=>{const I=R();if(!(s!=null&&s.length))return null;const N=u!=null&&u()?"a":"span";return a(L,{variant:"secondary",className:w(["order-shipping-status-card","order-shipping-status-card--return-order"]),children:[i($,{title:n.returnOrderCardTitle}),s==null?void 0:s.map((r,q)=>{var v;const f=r.items,g=(r==null?void 0:r.returnNumber)??"",T=(r==null?void 0:r.orderNumber)??"",O=(r==null?void 0:r.token)??"",_=(d==null?void 0:d({returnNumber:g,orderNumber:T,token:O}))??"#",y=(b==null?void 0:b({orderNumber:T,token:O}))??"#";return a("div",{children:[a("p",{children:[n.returnNumber," ",i("a",{href:_,rel:"noreferrer",children:r.returnNumber})]}),a("p",{children:[n.orderNumber," ",i("a",{href:y,rel:"noreferrer",children:r.orderNumber})]}),(v=r==null?void 0:r.tracking)==null?void 0:v.map((C,l)=>{var c,S;return a("p",{children:[`${n.carrier} ${(S=(c=C==null?void 0:C.carrier)==null?void 0:c.label)==null?void 0:S.toLocaleUpperCase()}: `,i("a",{href:`${(m==null?void 0:m(C))??"#"}`,rel:"noreferrer",children:C.trackingNumber})]},`${C.trackingNumber}_${l}`)}),p!=null&&p.ReturnItemsDetails?i(G,{"data-testid":"returnItemsDetails",name:"ReturnItemsDetails",slot:p==null?void 0:p.ReturnItemsDetails,context:{items:f}}):null,i(M,{actionIconPosition:"right","data-testid":"dropinAccordion",children:i(U,{defaultOpen:e>=(f==null?void 0:f.length),title:i(j,{id:"Order.ShippingStatusCard.itemText",plural:f==null?void 0:f.length,fields:{count:f==null?void 0:f.length}}),children:i(Q,{maxColumns:I?3:9,emptyGridContent:i(E,{}),className:w(["order-shipping-status-card__images",["order-shipping-status-card__images-3",I]]),children:f==null?void 0:f.map((C,l)=>{var A,h;const c=(A=C.thumbnail)==null?void 0:A.label,S=(h=C.thumbnail)==null?void 0:h.url;return i(N,{href:(u==null?void 0:u(C))??"#","data-testid":`${l}${C.uid}`,children:i(H,{alt:c,src:S,width:85,height:114})},`${l}${C.uid}`)})})})})]},q)})]})},nn=({translations:p,slots:e,orderData:n,collapseThreshold:s=10,routeProductDetails:d,routeReturnDetails:b,routeOrderDetails:m,routeTracking:u})=>{var T,O,_,y,v,C;const I=n==null?void 0:n.returnNumber,N=d!=null&&d()?"a":"span",r=(T=n==null?void 0:n.status)==null?void 0:T.toLocaleLowerCase(),f=((O=n==null?void 0:n.shipments)==null?void 0:O.length)===1&&(r==null?void 0:r.includes(F.COMPLETE)),g=(_=n==null?void 0:n.items)==null?void 0:_.filter(l=>(l==null?void 0:l.quantityShipped)===0);if(I&&((y=n==null?void 0:n.returns)!=null&&y.length)){const l=n==null?void 0:n.returns;return i(D,{slots:e,collapseThreshold:s,translations:p,orderReturn:l,routeReturnDetails:b,routeOrderDetails:m,routeTracking:u,routeProductDetails:d})}return!n||r!=null&&r.includes(F.CANCELED)?null:(v=n==null?void 0:n.shipments)!=null&&v.length?a(E,{children:[(C=n==null?void 0:n.shipments)==null?void 0:C.map(({tracking:l,items:c,id:S},A)=>a(L,{variant:"secondary",className:"order-shipping-status-card",children:[i($,{title:p.shippingCardTitle}),l==null?void 0:l.map(h=>{var x;return a("div",{className:"order-shipping-status-card__header",role:"status",children:[a("div",{className:"order-shipping-status-card__header--content",children:[a("p",{children:[p.carrier," ",(x=h==null?void 0:h.carrier)==null?void 0:x.toLocaleUpperCase()," | ",h==null?void 0:h.number]}),i("p",{children:h==null?void 0:h.title})]}),e!=null&&e.DeliveryTrackActions?i(G,{"data-testid":"deliverySlotActions",name:"DeliveryTrackActions",slot:e==null?void 0:e.DeliveryTrackActions,context:{trackInformation:h}}):null]},h.number)}),f?null:i(M,{actionIconPosition:"right","data-testid":"dropinAccordion",children:i(U,{"data-position":A+1,defaultOpen:s>=(c==null?void 0:c.length),title:i(E,{children:i(j,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:c==null?void 0:c.length,fields:{count:c==null?void 0:c.length}})}),children:i(Q,{maxColumns:6,emptyGridContent:i(E,{}),className:"order-shipping-status-card__images",children:c==null?void 0:c.map(h=>{var V,W,z,B,J,K;const x=(z=(W=(V=h==null?void 0:h.orderItem)==null?void 0:V.product)==null?void 0:W.thumbnail)==null?void 0:z.label,X=(K=(J=(B=h==null?void 0:h.orderItem)==null?void 0:B.product)==null?void 0:J.thumbnail)==null?void 0:K.url;return i(N,{href:(d==null?void 0:d(h))??"#",children:i(H,{alt:x,src:X||"",width:85,height:114})},h.id)})})})}),e!=null&&e.DeliveryTimeLine?i(G,{"data-testid":"deliverySlotTimeLine",name:"DeliveryTimeLine",slot:e==null?void 0:e.DeliveryTimeLine,context:{}}):null]},S)),g!=null&&g.length?a(L,{variant:"secondary",className:"order-shipping-status-card","data-testid":"dropinAccordionNotYetShipped2",children:[i($,{title:p.notYetShippedTitle}),i(M,{actionIconPosition:"right",children:i(U,{defaultOpen:s>=(g==null?void 0:g.length),title:i(j,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:g==null?void 0:g.length,fields:{count:g==null?void 0:g.length}}),children:i("div",{className:"order-shipping-status-card__images",children:g==null?void 0:g.map(l=>{var c,S;return i(N,{href:(d==null?void 0:d(l))??"#",children:i(H,{alt:(c=l.thumbnail)==null?void 0:c.label,src:((S=l.thumbnail)==null?void 0:S.url)||"",width:85,height:114})},l.id)})})})})]}):null]}):a(L,{variant:"secondary",className:"order-shipping-status-card",children:[i($,{title:p.shippingInfoTitle}),i("div",{className:"order-shipping-status-card__header",children:a("div",{className:"order-shipping-status-card__header--content",children:[n!=null&&n.carrier?i("p",{children:n==null?void 0:n.carrier}):null,i("p",{children:p.noInfoTitle})]})})]})},an=({slots:p,className:e,collapseThreshold:n,orderData:s,routeProductDetails:d,routeReturnDetails:b,routeOrderDetails:m,routeTracking:u})=>{const{order:I}=P({orderData:s}),N=o({carrier:"Order.ShippingStatusCard.carrier",prepositionOf:"Order.ShippingStatusCard.prepositionOf",returnOrderCardTitle:"Order.ShippingStatusCard.returnOrderCardTitle",shippingCardTitle:"Order.ShippingStatusCard.shippingCardTitle",shippingInfoTitle:"Order.ShippingStatusCard.shippingInfoTitle",notYetShippedTitle:"Order.ShippingStatusCard.notYetShippedTitle",noInfoTitle:"Order.ShippingStatusCard.noInfoTitle",returnNumber:"Order.ShippingStatusCard.returnNumber",orderNumber:"Order.ShippingStatusCard.orderNumber"});return i("div",{className:w(["order-shipping-status",e]),children:I?i(nn,{translations:N,routeProductDetails:d,routeReturnDetails:b,routeOrderDetails:m,routeTracking:u,slots:p,orderData:I,collapseThreshold:n}):i(k,{withCard:!1})})};export{an as ShippingStatus,an as default};
