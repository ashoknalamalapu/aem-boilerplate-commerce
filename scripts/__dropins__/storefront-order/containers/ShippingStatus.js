/*! Copyright 2024 Adobe
All Rights Reserved. */
import{jsxs as m,jsx as h,Fragment as v}from"@dropins/tools/preact-jsx-runtime.js";import{classes as I,Slot as G}from"@dropins/tools/lib.js";import{Card as M,Header as w,Accordion as y,AccordionSection as H,ContentGrid as L,Image as U}from"@dropins/tools/components.js";import"../chunks/OrderCancelReasonsForm.js";import{useState as Y,useEffect as j}from"@dropins/tools/preact-hooks.js";import{events as F}from"@dropins/tools/event-bus.js";import{u as q}from"../chunks/useIsMobile.js";import{Text as V,useText as W}from"@dropins/tools/i18n.js";import{C as z}from"../chunks/OrderLoaders.js";import"@dropins/tools/preact-compat.js";import"@dropins/tools/preact.js";var E=(r=>(r.PENDING="pending",r.SHIPPING="shipping",r.COMPLETE="complete",r.PROCESSING="processing",r.HOLD="on hold",r.CANCELED="Canceled",r.SUSPECTED_FRAUD="suspected fraud",r.PAYMENT_REVIEW="payment review",r))(E||{});const B=({orderData:r})=>{const[t,i]=Y(r);return j(()=>{const s=F.on("order/data",d=>{i(d)},{eager:!0});return()=>{s==null||s.off()}},[]),{order:t}},J=({slots:r,collapseThreshold:t,translations:i,orderReturn:s,routeReturnDetails:d,routeOrderDetails:u,routeTracking:S,routeProductDetails:c})=>{const f=q();if(!(s!=null&&s.length))return null;const C=c!=null&&c()?"a":"span";return m(M,{variant:"secondary",className:I(["order-shipping-status-card","order-shipping-status-card--return-order"]),children:[h(w,{title:i.returnOrderCardTitle}),s==null?void 0:s.map((n,o)=>{var T;const p=n.items,N=(n==null?void 0:n.returnNumber)??"",l=(n==null?void 0:n.orderNumber)??"",g=(n==null?void 0:n.token)??"",_=(d==null?void 0:d({returnNumber:N,orderNumber:l,token:g}))??"#",A=(u==null?void 0:u({orderNumber:l,token:g}))??"#";return m("div",{children:[m("p",{children:[i.returnNumber," ",h("a",{href:_,rel:"noreferrer",children:n.returnNumber})]}),m("p",{children:[i.orderNumber," ",h("a",{href:A,rel:"noreferrer",children:n.orderNumber})]}),(T=n==null?void 0:n.tracking)==null?void 0:T.map((e,b)=>{var a,O;return m("p",{children:[`${i.carrier} ${(O=(a=e==null?void 0:e.carrier)==null?void 0:a.label)==null?void 0:O.toLocaleUpperCase()}: `,h("a",{href:`${(S==null?void 0:S(e))??"#"}`,rel:"noreferrer",children:e.trackingNumber})]},`${e.trackingNumber}_${b}`)}),r!=null&&r.ReturnItemsDetails?h(G,{"data-testid":"returnItemsDetails",name:"ReturnItemsDetails",slot:r==null?void 0:r.ReturnItemsDetails,context:{items:p}}):null,h(y,{actionIconPosition:"right","data-testid":"dropinAccordion",children:h(H,{defaultOpen:t>=(p==null?void 0:p.length),title:h(V,{id:"Order.ShippingStatusCard.itemText",plural:p==null?void 0:p.length,fields:{count:p==null?void 0:p.length}}),children:h(L,{maxColumns:f?3:9,emptyGridContent:h(v,{}),className:I(["order-shipping-status-card__images",["order-shipping-status-card__images-3",f]]),children:p==null?void 0:p.map((e,b)=>{var $,x;const a=($=e.thumbnail)==null?void 0:$.label,O=(x=e.thumbnail)==null?void 0:x.url;return h(C,{href:(c==null?void 0:c(e))??"#","data-testid":`${b}${e.uid}`,children:h(U,{alt:a,src:O,width:85,height:114})},`${b}${e.uid}`)})})})})]},o)})]})},K=({translations:r,slots:t,orderData:i,collapseThreshold:s=10,routeProductDetails:d,routeReturnDetails:u,routeOrderDetails:S,routeTracking:c})=>{var o,p,N,l;const f=i==null?void 0:i.returnNumber,C=(o=i==null?void 0:i.status)==null?void 0:o.toLocaleLowerCase();if(((p=i==null?void 0:i.shipments)==null?void 0:p.length)===1&&(C==null||C.includes(E.COMPLETE)),(N=i==null?void 0:i.items)==null||N.filter(g=>(g==null?void 0:g.quantityShipped)===0),f&&((l=i==null?void 0:i.returns)!=null&&l.length)){const g=i==null?void 0:i.returns;return h(J,{slots:t,collapseThreshold:s,translations:r,orderReturn:g,routeReturnDetails:u,routeOrderDetails:S,routeTracking:c,routeProductDetails:d})}return null},hi=({slots:r,className:t,collapseThreshold:i,orderData:s,routeProductDetails:d,routeReturnDetails:u,routeOrderDetails:S,routeTracking:c})=>{const{order:f}=B({orderData:s}),C=W({carrier:"Order.ShippingStatusCard.carrier",prepositionOf:"Order.ShippingStatusCard.prepositionOf",returnOrderCardTitle:"Order.ShippingStatusCard.returnOrderCardTitle",shippingCardTitle:"Order.ShippingStatusCard.shippingCardTitle",shippingInfoTitle:"Order.ShippingStatusCard.shippingInfoTitle",notYetShippedTitle:"Order.ShippingStatusCard.notYetShippedTitle",noInfoTitle:"Order.ShippingStatusCard.noInfoTitle",returnNumber:"Order.ShippingStatusCard.returnNumber",orderNumber:"Order.ShippingStatusCard.orderNumber"});return h("div",{className:I(["order-shipping-status",t]),children:f?h(K,{translations:C,routeProductDetails:d,routeReturnDetails:u,routeOrderDetails:S,routeTracking:c,slots:r,orderData:f,collapseThreshold:i}):h(z,{withCard:!1})})};export{hi as ShippingStatus,hi as default};
