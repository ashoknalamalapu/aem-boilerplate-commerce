import{jsxs as t,jsx as i,Fragment as N}from"@dropins/tools/preact-jsx-runtime.js";import{classes as x,Slot as E}from"@dropins/tools/lib.js";import{Card as y,Header as A,Accordion as $,AccordionSection as L,ContentGrid as W,Image as w}from"@dropins/tools/components.js";import"../chunks/OrderCancelReasonsForm.js";import{useState as J,useEffect as K}from"@dropins/tools/preact-hooks.js";import{events as Q}from"@dropins/tools/event-bus.js";import{u as R}from"../chunks/useIsMobile.js";import{Text as G,useText as X}from"@dropins/tools/i18n.js";import{C as Z}from"../chunks/OrderLoaders.js";import"@dropins/tools/preact-compat.js";import"@dropins/tools/preact.js";var M=(e=>(e.PENDING="pending",e.SHIPPING="shipping",e.COMPLETE="complete",e.PROCESSING="processing",e.HOLD="on hold",e.CANCELED="Canceled",e.SUSPECTED_FRAUD="suspected fraud",e.PAYMENT_REVIEW="payment review",e))(M||{});const Y=({orderData:e})=>{const[h,n]=J(e);return K(()=>{const c=Q.on("order/data",d=>{n(d)},{eager:!0});return()=>{c==null||c.off()}},[]),{order:h}},P=({slots:e,collapseThreshold:h,translations:n,orderReturn:c,routeTracking:d,routeProductDetails:C})=>{const T=R();if(!(c!=null&&c.length))return null;const f=C?"a":"span";return t(y,{variant:"secondary",className:x(["order-shipping-status-card","order-shipping-status-card--return-order"]),children:[i(A,{title:n.returnOrderCardTitle}),c==null?void 0:c.map((g,U)=>{var l,O;const s=g.items;return(l=g==null?void 0:g.tracking)!=null&&l.length?t("div",{children:[(O=g==null?void 0:g.tracking)==null?void 0:O.map((a,m)=>{var S,I;return t("p",{children:[`${n.carrier} ${(I=(S=a==null?void 0:a.carrier)==null?void 0:S.label)==null?void 0:I.toLocaleUpperCase()}: `,i("a",{href:`${(d==null?void 0:d(a))??"#"}`,rel:"noreferrer",children:a.trackingNumber})]},`${a.trackingNumber}_${m}`)}),e!=null&&e.ReturnItemsDetails?i(E,{"data-testid":"returnItemsDetails",name:"ReturnItemsDetails",slot:e==null?void 0:e.ReturnItemsDetails,context:{items:s}}):null,i($,{actionIconPosition:"right","data-testid":"dropinAccordion",children:i(L,{defaultOpen:h>=(s==null?void 0:s.length),title:i(G,{id:"Order.ShippingStatusCard.itemText",plural:s==null?void 0:s.length,fields:{count:s==null?void 0:s.length}}),children:i(W,{maxColumns:T?3:9,emptyGridContent:i(N,{}),className:x(["order-shipping-status-card__images",["order-shipping-status-card__images-3",T]]),children:s==null?void 0:s.map((a,m)=>{var b,r;const S=(b=a.thumbnail)==null?void 0:b.label,I=(r=a.thumbnail)==null?void 0:r.url;return i(f,{href:(C==null?void 0:C(a))??"#","data-testid":`${m}${a.uid}`,children:i(w,{alt:S,src:I,width:85,height:114})},`${m}${a.uid}`)})})})})]},U):null})]})},k=({translations:e,slots:h,orderData:n,collapseThreshold:c=10,routeProductDetails:d,routeTracking:C})=>{var O,a,m,S,I,b;const T=!!(n!=null&&n.returnNumber),f=d?"a":"span",g=(O=n==null?void 0:n.status)==null?void 0:O.toLocaleLowerCase(),s=((a=n==null?void 0:n.shipments)==null?void 0:a.length)===1&&(g==null?void 0:g.includes(M.COMPLETE)),l=(m=n==null?void 0:n.items)==null?void 0:m.filter(r=>(r==null?void 0:r.quantityShipped)===0);if(T&&((S=n==null?void 0:n.returns)!=null&&S.length)){const r=n==null?void 0:n.returns;return i(P,{slots:h,collapseThreshold:c,translations:e,orderReturn:r,routeTracking:C,routeProductDetails:d})}return!n||g!=null&&g.includes(M.CANCELED)?null:(I=n==null?void 0:n.shipments)!=null&&I.length?t(N,{children:[(b=n==null?void 0:n.shipments)==null?void 0:b.map(({tracking:r,items:u,id:v},z)=>t(y,{variant:"secondary",className:"order-shipping-status-card",children:[i(A,{title:e.shippingCardTitle}),r==null?void 0:r.map(p=>{var _;return t("div",{className:"order-shipping-status-card__header",role:"status",children:[t("div",{className:"order-shipping-status-card__header--content",children:[t("p",{children:[e.carrier," ",(_=p==null?void 0:p.carrier)==null?void 0:_.toLocaleUpperCase()," | ",p==null?void 0:p.number]}),i("p",{children:p==null?void 0:p.title})]}),h!=null&&h.DeliveryTrackActions?i(E,{"data-testid":"deliverySlotActions",name:"DeliveryTrackActions",slot:h==null?void 0:h.DeliveryTrackActions,context:{trackInformation:p}}):null]},p.number)}),s?null:i($,{actionIconPosition:"right","data-testid":"dropinAccordion",children:i(L,{"data-position":z+1,defaultOpen:c>=(u==null?void 0:u.length),title:i(N,{children:i(G,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:u==null?void 0:u.length,fields:{count:u==null?void 0:u.length}})}),children:i(W,{maxColumns:6,emptyGridContent:i(N,{}),className:"order-shipping-status-card__images",children:u==null?void 0:u.map(p=>{var H,j,o,F,q,V;const _=(o=(j=(H=p==null?void 0:p.orderItem)==null?void 0:H.product)==null?void 0:j.thumbnail)==null?void 0:o.label,B=(V=(q=(F=p==null?void 0:p.orderItem)==null?void 0:F.product)==null?void 0:q.thumbnail)==null?void 0:V.url;return i(f,{href:(d==null?void 0:d(p))??"#",children:i(w,{alt:_,src:B||"",width:85,height:114})},p.id)})})})}),h!=null&&h.DeliveryTimeLine?i(E,{"data-testid":"deliverySlotTimeLine",name:"DeliveryTimeLine",slot:h==null?void 0:h.DeliveryTimeLine,context:{}}):null]},v)),l!=null&&l.length?t(y,{variant:"secondary",className:"order-shipping-status-card","data-testid":"dropinAccordionNotYetShipped2",children:[i(A,{title:e.notYetShippedTitle}),i($,{actionIconPosition:"right",children:i(L,{defaultOpen:c>=(l==null?void 0:l.length),title:i(G,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:l==null?void 0:l.length,fields:{count:l==null?void 0:l.length}}),children:i("div",{className:"order-shipping-status-card__images",children:l==null?void 0:l.map(r=>{var u,v;return i(f,{href:(d==null?void 0:d(r))??"#",children:i(w,{alt:(u=r.thumbnail)==null?void 0:u.label,src:((v=r.thumbnail)==null?void 0:v.url)||"",width:85,height:114})},r.id)})})})})]}):null]}):t(y,{variant:"secondary",className:"order-shipping-status-card",children:[i(A,{title:e.shippingInfoTitle}),i("div",{className:"order-shipping-status-card__header",children:t("div",{className:"order-shipping-status-card__header--content",children:[n!=null&&n.carrier?i("p",{children:n==null?void 0:n.carrier}):null,i("p",{children:e.noInfoTitle})]})})]})},an=({slots:e,className:h,collapseThreshold:n,orderData:c,routeOrderDetails:d,routeTracking:C,routeProductDetails:T})=>{const{order:f}=Y({orderData:c}),g=X({carrier:"Order.ShippingStatusCard.carrier",prepositionOf:"Order.ShippingStatusCard.prepositionOf",returnOrderCardTitle:"Order.ShippingStatusCard.returnOrderCardTitle",shippingCardTitle:"Order.ShippingStatusCard.shippingCardTitle",shippingInfoTitle:"Order.ShippingStatusCard.shippingInfoTitle",notYetShippedTitle:"Order.ShippingStatusCard.notYetShippedTitle",noInfoTitle:"Order.ShippingStatusCard.noInfoTitle",returnNumber:"Order.ShippingStatusCard.returnNumber",orderNumber:"Order.ShippingStatusCard.orderNumber"});return i("div",{className:x(["order-shipping-status",h]),children:f?i(k,{translations:g,routeOrderDetails:d,routeTracking:C,slots:e,orderData:f,collapseThreshold:n,routeProductDetails:T}):i(Z,{withCard:!1})})};export{an as ShippingStatus,an as default};
