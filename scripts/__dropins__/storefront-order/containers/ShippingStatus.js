/*! Copyright 2024 Adobe
All Rights Reserved. */
import{jsxs as f,jsx as i,Fragment as _}from"@dropins/tools/preact-jsx-runtime.js";import{classes as x,Slot as E}from"@dropins/tools/lib.js";import{Card as y,Header as A,Accordion as $,AccordionSection as L,ContentGrid as z,Image as w}from"@dropins/tools/components.js";import"../chunks/OrderCancelReasonsForm.js";import{useState as K,useEffect as Q}from"@dropins/tools/preact-hooks.js";import{events as X}from"@dropins/tools/event-bus.js";import{u as Z}from"../chunks/useIsMobile.js";import{Text as G,useText as R}from"@dropins/tools/i18n.js";import{C as Y}from"../chunks/OrderLoaders.js";import"@dropins/tools/preact-compat.js";import"@dropins/tools/preact.js";var M=(e=>(e.PENDING="pending",e.SHIPPING="shipping",e.COMPLETE="complete",e.PROCESSING="processing",e.HOLD="on hold",e.CANCELED="Canceled",e.SUSPECTED_FRAUD="suspected fraud",e.PAYMENT_REVIEW="payment review",e))(M||{});const o=({orderData:e})=>{const[h,n]=K(e);return Q(()=>{const c=X.on("order/data",l=>{n(l)},{eager:!0});return()=>{c==null||c.off()}},[]),{order:h}},k=({slots:e,collapseThreshold:h,translations:n,orderReturn:c,routeTracking:l,routeProductDetails:m})=>{const S=Z();if(!(c!=null&&c.length))return null;const O=m!=null&&m()?"a":"span";return f(y,{variant:"secondary",className:x(["order-shipping-status-card","order-shipping-status-card--return-order"]),children:[i(A,{title:n.returnOrderCardTitle}),c==null?void 0:c.map((C,U)=>{var r;const d=C.items;return f("div",{children:[(r=C==null?void 0:C.tracking)==null?void 0:r.map((g,u)=>{var I,T;return f("p",{children:[`${n.carrier} ${(T=(I=g==null?void 0:g.carrier)==null?void 0:I.label)==null?void 0:T.toLocaleUpperCase()}: `,i("a",{href:`${(l==null?void 0:l(g))??"#"}`,rel:"noreferrer",children:g.trackingNumber})]},`${g.trackingNumber}_${u}`)}),e!=null&&e.ReturnItemsDetails?i(E,{"data-testid":"returnItemsDetails",name:"ReturnItemsDetails",slot:e==null?void 0:e.ReturnItemsDetails,context:{items:d}}):null,i($,{actionIconPosition:"right","data-testid":"dropinAccordion",children:i(L,{defaultOpen:h>=(d==null?void 0:d.length),title:i(G,{id:"Order.ShippingStatusCard.itemText",plural:d==null?void 0:d.length,fields:{count:d==null?void 0:d.length}}),children:i(z,{maxColumns:S?3:9,emptyGridContent:i(_,{}),className:x(["order-shipping-status-card__images",["order-shipping-status-card__images-3",S]]),children:d==null?void 0:d.map((g,u)=>{var b,t;const I=(b=g.thumbnail)==null?void 0:b.label,T=(t=g.thumbnail)==null?void 0:t.url;return i(O,{href:(m==null?void 0:m(g))??"#","data-testid":`${u}${g.uid}`,children:i(w,{alt:I,src:T,width:85,height:114})},`${u}${g.uid}`)})})})})]},U)})]})},P=({translations:e,slots:h,orderData:n,collapseThreshold:c=10,routeProductDetails:l,routeTracking:m})=>{var g,u,I,T,b,t;const S=n==null?void 0:n.returnNumber,O=l!=null&&l()?"a":"span",C=(g=n==null?void 0:n.status)==null?void 0:g.toLocaleLowerCase(),d=((u=n==null?void 0:n.shipments)==null?void 0:u.length)===1&&(C==null?void 0:C.includes(M.COMPLETE)),r=(I=n==null?void 0:n.items)==null?void 0:I.filter(a=>(a==null?void 0:a.quantityShipped)===0);if(S&&((T=n==null?void 0:n.returns)!=null&&T.length)){const a=n==null?void 0:n.returns;return i(k,{slots:h,collapseThreshold:c,translations:e,orderReturn:a,routeTracking:m,routeProductDetails:l})}return!n||C!=null&&C.includes(M.CANCELED)?null:(b=n==null?void 0:n.shipments)!=null&&b.length?f(_,{children:[(t=n==null?void 0:n.shipments)==null?void 0:t.map(({tracking:a,items:s,id:v},B)=>f(y,{variant:"secondary",className:"order-shipping-status-card",children:[i(A,{title:e.shippingCardTitle}),a==null?void 0:a.map(p=>{var N;return f("div",{className:"order-shipping-status-card__header",role:"status",children:[f("div",{className:"order-shipping-status-card__header--content",children:[f("p",{children:[e.carrier," ",(N=p==null?void 0:p.carrier)==null?void 0:N.toLocaleUpperCase()," | ",p==null?void 0:p.number]}),i("p",{children:p==null?void 0:p.title})]}),h!=null&&h.DeliveryTrackActions?i(E,{"data-testid":"deliverySlotActions",name:"DeliveryTrackActions",slot:h==null?void 0:h.DeliveryTrackActions,context:{trackInformation:p}}):null]},p.number)}),d?null:i($,{actionIconPosition:"right","data-testid":"dropinAccordion",children:i(L,{"data-position":B+1,defaultOpen:c>=(s==null?void 0:s.length),title:i(_,{children:i(G,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:s==null?void 0:s.length,fields:{count:s==null?void 0:s.length}})}),children:i(z,{maxColumns:6,emptyGridContent:i(_,{}),className:"order-shipping-status-card__images",children:s==null?void 0:s.map(p=>{var H,j,F,q,V,W;const N=(F=(j=(H=p==null?void 0:p.orderItem)==null?void 0:H.product)==null?void 0:j.thumbnail)==null?void 0:F.label,J=(W=(V=(q=p==null?void 0:p.orderItem)==null?void 0:q.product)==null?void 0:V.thumbnail)==null?void 0:W.url;return i(O,{href:(l==null?void 0:l(p))??"#",children:i(w,{alt:N,src:J||"",width:85,height:114})},p.id)})})})}),h!=null&&h.DeliveryTimeLine?i(E,{"data-testid":"deliverySlotTimeLine",name:"DeliveryTimeLine",slot:h==null?void 0:h.DeliveryTimeLine,context:{}}):null]},v)),r!=null&&r.length?f(y,{variant:"secondary",className:"order-shipping-status-card","data-testid":"dropinAccordionNotYetShipped2",children:[i(A,{title:e.notYetShippedTitle}),i($,{actionIconPosition:"right",children:i(L,{defaultOpen:c>=(r==null?void 0:r.length),title:i(G,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:r==null?void 0:r.length,fields:{count:r==null?void 0:r.length}}),children:i("div",{className:"order-shipping-status-card__images",children:r==null?void 0:r.map(a=>{var s,v;return i(O,{href:(l==null?void 0:l(a))??"#",children:i(w,{alt:(s=a.thumbnail)==null?void 0:s.label,src:((v=a.thumbnail)==null?void 0:v.url)||"",width:85,height:114})},a.id)})})})})]}):null]}):f(y,{variant:"secondary",className:"order-shipping-status-card",children:[i(A,{title:e.shippingInfoTitle}),i("div",{className:"order-shipping-status-card__header",children:f("div",{className:"order-shipping-status-card__header--content",children:[n!=null&&n.carrier?i("p",{children:n==null?void 0:n.carrier}):null,i("p",{children:e.noInfoTitle})]})})]})},an=({slots:e,className:h,collapseThreshold:n,orderData:c,routeOrderDetails:l,routeTracking:m})=>{const{order:S}=o({orderData:c}),O=R({carrier:"Order.ShippingStatusCard.carrier",prepositionOf:"Order.ShippingStatusCard.prepositionOf",returnOrderCardTitle:"Order.ShippingStatusCard.returnOrderCardTitle",shippingCardTitle:"Order.ShippingStatusCard.shippingCardTitle",shippingInfoTitle:"Order.ShippingStatusCard.shippingInfoTitle",notYetShippedTitle:"Order.ShippingStatusCard.notYetShippedTitle",noInfoTitle:"Order.ShippingStatusCard.noInfoTitle",returnNumber:"Order.ShippingStatusCard.returnNumber",orderNumber:"Order.ShippingStatusCard.orderNumber"});return i("div",{className:x(["order-shipping-status",h]),children:S?i(P,{translations:O,routeOrderDetails:l,routeTracking:m,slots:e,orderData:S,collapseThreshold:n}):i(Y,{withCard:!1})})};export{an as ShippingStatus,an as default};
