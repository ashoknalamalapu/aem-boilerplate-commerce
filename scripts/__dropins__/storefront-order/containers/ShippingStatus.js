import{jsxs as t,jsx as i,Fragment as N}from"@dropins/tools/preact-jsx-runtime.js";import{classes as x,Slot as E}from"@dropins/tools/lib.js";import{Card as y,Header as A,Accordion as $,AccordionSection as L,ContentGrid as W,Image as w}from"@dropins/tools/components.js";import"../chunks/OrderCancelReasonsForm.js";import{useState as J,useEffect as K}from"@dropins/tools/preact-hooks.js";import{events as Q}from"@dropins/tools/event-bus.js";import{u as R}from"../chunks/useIsMobile.js";import{Text as G,useText as X}from"@dropins/tools/i18n.js";import{C as Z}from"../chunks/OrderLoaders.js";import"@dropins/tools/preact-compat.js";import"@dropins/tools/preact.js";var M=(e=>(e.PENDING="pending",e.SHIPPING="shipping",e.COMPLETE="complete",e.PROCESSING="processing",e.HOLD="on hold",e.CANCELED="Canceled",e.SUSPECTED_FRAUD="suspected fraud",e.PAYMENT_REVIEW="payment review",e))(M||{});const Y=({orderData:e})=>{const[l,n]=J(e);return K(()=>{const r=Q.on("order/data",c=>{n(c)},{eager:!0});return()=>{r==null||r.off()}},[]),{order:l}},P=({slots:e,collapseThreshold:l,translations:n,orderReturn:r,routeTracking:c,routeProductDetails:C})=>{const T=R();if(!(r!=null&&r.length))return null;const f=C?"a":"span";return t(y,{variant:"secondary",className:x(["order-shipping-status-card","order-shipping-status-card--return-order"]),children:[i(A,{title:n.returnOrderCardTitle}),r==null?void 0:r.map((u,U)=>{var h;const d=u.items;return t("div",{children:[(h=u==null?void 0:u.tracking)==null?void 0:h.map((g,m)=>{var S,I;return t("p",{children:[`${n.carrier} ${(I=(S=g==null?void 0:g.carrier)==null?void 0:S.label)==null?void 0:I.toLocaleUpperCase()}: `,i("a",{href:`${(c==null?void 0:c(g))??"#"}`,rel:"noreferrer",children:g.trackingNumber})]},`${g.trackingNumber}_${m}`)}),e!=null&&e.ReturnItemsDetails?i(E,{"data-testid":"returnItemsDetails",name:"ReturnItemsDetails",slot:e==null?void 0:e.ReturnItemsDetails,context:{items:d}}):null,i($,{actionIconPosition:"right","data-testid":"dropinAccordion",children:i(L,{defaultOpen:l>=(d==null?void 0:d.length),title:i(G,{id:"Order.ShippingStatusCard.itemText",plural:d==null?void 0:d.length,fields:{count:d==null?void 0:d.length}}),children:i(W,{maxColumns:T?3:9,emptyGridContent:i(N,{}),className:x(["order-shipping-status-card__images",["order-shipping-status-card__images-3",T]]),children:d==null?void 0:d.map((g,m)=>{var O,b;const S=(O=g.thumbnail)==null?void 0:O.label,I=(b=g.thumbnail)==null?void 0:b.url;return i(f,{href:(C==null?void 0:C(g))??"#","data-testid":`${m}${g.uid}`,children:i(w,{alt:S,src:I,width:85,height:114})},`${m}${g.uid}`)})})})})]},U)})]})},k=({translations:e,slots:l,orderData:n,collapseThreshold:r=10,routeProductDetails:c,routeTracking:C})=>{var g,m,S,I,O,b;const T=!!(n!=null&&n.returnNumber),f=c?"a":"span",u=(g=n==null?void 0:n.status)==null?void 0:g.toLocaleLowerCase(),d=((m=n==null?void 0:n.shipments)==null?void 0:m.length)===1&&(u==null?void 0:u.includes(M.COMPLETE)),h=(S=n==null?void 0:n.items)==null?void 0:S.filter(a=>(a==null?void 0:a.quantityShipped)===0);if(T&&((I=n==null?void 0:n.returns)!=null&&I.length)){const a=n==null?void 0:n.returns;return i(P,{slots:l,collapseThreshold:r,translations:e,orderReturn:a,routeTracking:C,routeProductDetails:c})}return!n||u!=null&&u.includes(M.CANCELED)?null:(O=n==null?void 0:n.shipments)!=null&&O.length?t(N,{children:[(b=n==null?void 0:n.shipments)==null?void 0:b.map(({tracking:a,items:s,id:v},z)=>t(y,{variant:"secondary",className:"order-shipping-status-card",children:[i(A,{title:e.shippingCardTitle}),a==null?void 0:a.map(p=>{var _;return t("div",{className:"order-shipping-status-card__header",role:"status",children:[t("div",{className:"order-shipping-status-card__header--content",children:[t("p",{children:[e.carrier," ",(_=p==null?void 0:p.carrier)==null?void 0:_.toLocaleUpperCase()," | ",p==null?void 0:p.number]}),i("p",{children:p==null?void 0:p.title})]}),l!=null&&l.DeliveryTrackActions?i(E,{"data-testid":"deliverySlotActions",name:"DeliveryTrackActions",slot:l==null?void 0:l.DeliveryTrackActions,context:{trackInformation:p}}):null]},p.number)}),d?null:i($,{actionIconPosition:"right","data-testid":"dropinAccordion",children:i(L,{"data-position":z+1,defaultOpen:r>=(s==null?void 0:s.length),title:i(N,{children:i(G,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:s==null?void 0:s.length,fields:{count:s==null?void 0:s.length}})}),children:i(W,{maxColumns:6,emptyGridContent:i(N,{}),className:"order-shipping-status-card__images",children:s==null?void 0:s.map(p=>{var H,j,o,F,q,V;const _=(o=(j=(H=p==null?void 0:p.orderItem)==null?void 0:H.product)==null?void 0:j.thumbnail)==null?void 0:o.label,B=(V=(q=(F=p==null?void 0:p.orderItem)==null?void 0:F.product)==null?void 0:q.thumbnail)==null?void 0:V.url;return i(f,{href:(c==null?void 0:c(p))??"#",children:i(w,{alt:_,src:B||"",width:85,height:114})},p.id)})})})}),l!=null&&l.DeliveryTimeLine?i(E,{"data-testid":"deliverySlotTimeLine",name:"DeliveryTimeLine",slot:l==null?void 0:l.DeliveryTimeLine,context:{}}):null]},v)),h!=null&&h.length?t(y,{variant:"secondary",className:"order-shipping-status-card","data-testid":"dropinAccordionNotYetShipped2",children:[i(A,{title:e.notYetShippedTitle}),i($,{actionIconPosition:"right",children:i(L,{defaultOpen:r>=(h==null?void 0:h.length),title:i(G,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:h==null?void 0:h.length,fields:{count:h==null?void 0:h.length}}),children:i("div",{className:"order-shipping-status-card__images",children:h==null?void 0:h.map(a=>{var s,v;return i(f,{href:(c==null?void 0:c(a))??"#",children:i(w,{alt:(s=a.thumbnail)==null?void 0:s.label,src:((v=a.thumbnail)==null?void 0:v.url)||"",width:85,height:114})},a.id)})})})})]}):null]}):t(y,{variant:"secondary",className:"order-shipping-status-card",children:[i(A,{title:e.shippingInfoTitle}),i("div",{className:"order-shipping-status-card__header",children:t("div",{className:"order-shipping-status-card__header--content",children:[n!=null&&n.carrier?i("p",{children:n==null?void 0:n.carrier}):null,i("p",{children:e.noInfoTitle})]})})]})},an=({slots:e,className:l,collapseThreshold:n,orderData:r,routeOrderDetails:c,routeTracking:C,routeProductDetails:T})=>{const{order:f}=Y({orderData:r}),u=X({carrier:"Order.ShippingStatusCard.carrier",prepositionOf:"Order.ShippingStatusCard.prepositionOf",returnOrderCardTitle:"Order.ShippingStatusCard.returnOrderCardTitle",shippingCardTitle:"Order.ShippingStatusCard.shippingCardTitle",shippingInfoTitle:"Order.ShippingStatusCard.shippingInfoTitle",notYetShippedTitle:"Order.ShippingStatusCard.notYetShippedTitle",noInfoTitle:"Order.ShippingStatusCard.noInfoTitle",returnNumber:"Order.ShippingStatusCard.returnNumber",orderNumber:"Order.ShippingStatusCard.orderNumber"});return i("div",{className:x(["order-shipping-status",l]),children:f?i(k,{translations:u,routeOrderDetails:c,routeTracking:C,slots:e,orderData:f,collapseThreshold:n,routeProductDetails:T}):i(Z,{withCard:!1})})};export{an as ShippingStatus,an as default};
