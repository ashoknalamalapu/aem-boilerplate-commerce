/*! Copyright 2024 Adobe
All Rights Reserved. */
import{jsx as i,jsxs as b,Fragment as w}from"@dropins/tools/preact-jsx-runtime.js";import{Card as U,Header as X,Price as Y,CartItem as g,Icon as T,Image as K}from"@dropins/tools/components.js";import"../chunks/OrderCancelReasonsForm.js";import{classes as N}from"@dropins/tools/lib.js";import{useState as c,useEffect as A,useMemo as I,useCallback as p}from"@dropins/tools/preact-hooks.js";import{events as ee}from"@dropins/tools/event-bus.js";import{s as te}from"../chunks/setTaxStatus.js";import{g as ne}from"../chunks/getStoreConfig.js";import*as C from"@dropins/tools/preact-compat.js";import{Fragment as le}from"@dropins/tools/preact.js";import{O as ae}from"../chunks/OrderLoaders.js";import{useText as se}from"@dropins/tools/i18n.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";const ie=u=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...u},C.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),C.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.75 5.88423V4.75H12.25V5.88423L12.0485 13.0713H11.9515L11.75 5.88423ZM11.7994 18.25V16.9868H12.2253V18.25H11.7994Z",stroke:"currentColor"})),re=({orderData:u})=>{const[e,r]=c(!0),[O,h]=c(u),[d,o]=c({taxIncluded:!1,taxExcluded:!1});return A(()=>{ne().then(s=>{s&&o(te(s==null?void 0:s.shoppingCartDisplayPrice))}).finally(()=>{r(!1)})},[]),A(()=>{const s=ee.on("order/data",v=>{h(v)},{eager:!0});return()=>{s==null||s.off()}},[]),{loading:e,taxConfig:d,order:O}},me=({loading:u,taxConfig:e,order:r=null,withHeader:O=!0,showConfigurableOptions:h,routeProductDetails:d})=>{const o=r==null?void 0:r.returnNumber,s=se({cancelled:"Order.OrderProductListContent.cancelledTitle",allOrders:"Order.OrderProductListContent.allOrdersTitle",returned:"Order.OrderProductListContent.returnedTitle",refunded:"Order.OrderProductListContent.refundedTitle",sender:"Order.OrderProductListContent.GiftCard.sender",recipient:"Order.OrderProductListContent.GiftCard.recipient",message:"Order.OrderProductListContent.GiftCard.message",outOfStock:"Order.OrderProductListContent.stockStatus.outOfStock",downloadableCount:"Order.OrderProductListContent.downloadableCount"}),v=I(()=>{if(!r)return[];const a=o?r.returns[0]:r,{items:y}=a;return[{type:"refunded",list:y.filter(m=>m.quantityRefunded),title:s.refunded},{type:"returned",list:y.filter(m=>m.quantityReturned),title:s.returned},{type:"cancelled",list:y.filter(m=>m.quantityCanceled&&!o),title:s.cancelled},{type:"",list:y.filter(m=>!m.quantityCanceled&&!o),title:s.allOrders}]},[r,o,s]);return r?v.every(a=>a.list.length===0)?null:i(U,{variant:"secondary",className:"order-order-product-list-content",children:v.filter(a=>a.list.length).map((a,y)=>{var m;return b(le,{children:[O?i(X,{title:`${a.title} (${a.list.length})`}):null,i("ul",{className:"order-order-product-list-content__items",children:(m=a.list)==null?void 0:m.map(E=>i("li",{"data-testid":"order-product-list-content-item",children:i(he,{loading:u,product:E,itemType:a.type,taxConfig:e,translations:s,showConfigurableOptions:h,routeProductDetails:d})},E.id))})]},y)})}):i(ae,{})},he=({loading:u,product:e,itemType:r,taxConfig:O,translations:h,showConfigurableOptions:d,routeProductDetails:o})=>{var _,x,Q,q,H,V,$,M,F,G,P,R,Z,j,z,W,B;const{taxExcluded:s,taxIncluded:v}=O,a=p((k,D,J)=>i(Y,{amount:k,currency:D,weight:"normal",...J}),[]);let y={};const m=r==="cancelled",E=(x=(_=e==null?void 0:e.product)==null?void 0:_.stockStatus)==null?void 0:x.includes("IN_STOCK"),t=(e==null?void 0:e.giftCard)||{},n=(Q=e==null?void 0:e.itemPrices)==null?void 0:Q.priceIncludingTax,l=(q=e==null?void 0:e.itemPrices)==null?void 0:q.originalPrice,f=(H=e==null?void 0:e.itemPrices)==null?void 0:H.price,L=e.discounted&&((V=e.price)==null?void 0:V.value)!==(l==null?void 0:l.value)*(e==null?void 0:e.totalQuantity),S={..."configurableOptions"in e?e.configurableOptions:{},..."bundleOptions"in e?e.bundleOptions:{},..."senderName"in t&&(t!=null&&t.senderName)?{[h.sender]:t==null?void 0:t.senderName}:{},..."senderEmail"in t&&(t!=null&&t.senderEmail)?{[h.sender]:t==null?void 0:t.senderEmail}:{},..."recipientName"in t&&(t!=null&&t.recipientName)?{[h.recipient]:t==null?void 0:t.recipientName}:{},..."recipientEmail"in t&&(t!=null&&t.recipientEmail)?{[h.recipient]:t==null?void 0:t.recipientEmail}:{},..."message"in t&&(t!=null&&t.message)?{[h.message]:t==null?void 0:t.message}:{},..."downloadableLinks"in e&&(e!=null&&e.downloadableLinks)?{[`${($=e==null?void 0:e.downloadableLinks)==null?void 0:$.count} ${h.downloadableCount}`]:(M=e==null?void 0:e.downloadableLinks)==null?void 0:M.result}:{}};if(v&&s){const k=L?l==null?void 0:l.value:(n==null?void 0:n.value)*(e==null?void 0:e.totalQuantity);y={taxExcluded:!0,taxIncluded:void 0,price:a(l==null?void 0:l.value,l==null?void 0:l.currency),total:b(w,{children:[a(k,l==null?void 0:l.currency,{variant:e.discounted&&(n==null?void 0:n.value)!==k?"strikethrough":"default"}),e.discounted&&(n==null?void 0:n.value)!==k?a(n==null?void 0:n.value,n==null?void 0:n.currency,{sale:!0,weight:"bold"}):null]}),totalExcludingTax:a((f==null?void 0:f.value)*e.totalQuantity,f==null?void 0:f.currency)}}else if(!v&&s)y={taxExcluded:void 0,taxIncluded:void 0,price:a(l==null?void 0:l.value,l==null?void 0:l.currency),total:b(w,{children:[a((l==null?void 0:l.value)*(e==null?void 0:e.totalQuantity),n==null?void 0:n.currency,{variant:L?"strikethrough":"default"}),L?a((F=e.price)==null?void 0:F.value,(G=e.price)==null?void 0:G.currency,{sale:!0,weight:"bold"}):null]}),totalExcludingTax:a((f==null?void 0:f.value)*(e==null?void 0:e.totalQuantity),f==null?void 0:f.currency)};else if(v&&!s){const k=L?l.value:n.value*e.totalQuantity;y={taxExcluded:void 0,taxIncluded:!0,price:a(n==null?void 0:n.value,n==null?void 0:n.currency),total:b(w,{children:[a(k,n==null?void 0:n.currency,{variant:L?"strikethrough":"default",weight:"bold"}),L?a(n==null?void 0:n.value,n==null?void 0:n.currency,{sale:!0,weight:"bold"}):null]})}}return i(g,{loading:u,alert:m&&E?b("span",{children:[i(T,{source:ie}),h.outOfStock]}):i(w,{}),configurations:(d==null?void 0:d(S))??S,title:o?i("a",{"data-testid":"product-name",className:N(["cart-summary-item__title",["cart-summary-item__title--strikethrough",m]]),href:o(e),children:(P=e==null?void 0:e.product)==null?void 0:P.name}):i("div",{"data-testid":"product-name",className:N(["cart-summary-item__title",["cart-summary-item__title--strikethrough",m]]),children:(R=e==null?void 0:e.product)==null?void 0:R.name}),sku:i("div",{children:(Z=e==null?void 0:e.product)==null?void 0:Z.sku}),quantity:e.totalQuantity,image:o?i("a",{href:o(e),children:i(K,{src:(j=e==null?void 0:e.product)==null?void 0:j.thumbnail.url,alt:(z=e==null?void 0:e.product)==null?void 0:z.thumbnail.label,loading:"lazy",width:"90",height:"120"})}):i(K,{src:(W=e==null?void 0:e.product)==null?void 0:W.thumbnail.url,alt:(B=e==null?void 0:e.product)==null?void 0:B.thumbnail.label,loading:"lazy",width:"90",height:"120"}),...y})},Ce=({className:u,orderData:e,withHeader:r,showConfigurableOptions:O,routeProductDetails:h})=>{const{loading:d,taxConfig:o,order:s}=re({orderData:e});return i("div",{className:N(["order-order-product-list",u]),children:i(me,{loading:d,taxConfig:o,order:s,withHeader:r,showConfigurableOptions:O,routeProductDetails:h})})};export{Ce as OrderProductList,Ce as default};
