import{jsx as r,jsxs as k,Fragment as E}from"@dropins/tools/preact-jsx-runtime.js";import{Card as Z,Header as j,Price as W,CartItem as z,Icon as B,Image as K}from"@dropins/tools/components.js";import"../chunks/OrderCancelReasonsForm.js";import{classes as q}from"@dropins/tools/lib.js";import*as L from"@dropins/tools/preact-compat.js";import{useMemo as R,useCallback as A,useState as b,useEffect as P}from"@dropins/tools/preact-hooks.js";import{Fragment as J}from"@dropins/tools/preact.js";import{O as U}from"../chunks/OrderLoaders.js";import{events as X}from"@dropins/tools/event-bus.js";import{useText as Y}from"@dropins/tools/i18n.js";import{s as g}from"../chunks/setTaxStatus.js";import{g as I}from"../chunks/getStoreConfig.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";const T=u=>L.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...u},L.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),L.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.75 5.88423V4.75H12.25V5.88423L12.0485 13.0713H11.9515L11.75 5.88423ZM11.7994 18.25V16.9868H12.2253V18.25H11.7994Z",stroke:"currentColor"})),p=({loading:u,taxConfig:e,order:d=null,withHeader:c=!0,showConfigurableOptions:i})=>{const m=Y({cancelled:"Order.OrderProductListContent.cancelledTitle",allOrders:"Order.OrderProductListContent.allOrdersTitle",sender:"Order.OrderProductListContent.GiftCard.sender",recipient:"Order.OrderProductListContent.GiftCard.recipient",message:"Order.OrderProductListContent.GiftCard.message",outOfStock:"Order.OrderProductListContent.stockStatus.outOfStock",downloadableCount:"Order.OrderProductListContent.downloadableCount"}),h=R(()=>{if(!d)return[];const{items:s}=d;return[{type:"cancelled",list:s.filter(a=>a.quantityCanceled),title:m.cancelled},{type:"",list:s.filter(a=>!a.quantityCanceled),title:m.allOrders}]},[d,m]);return d?r(Z,{variant:"secondary",className:"order-order-product-list-content",children:h.filter(s=>s.list.length).map((s,a)=>{var v;return k(J,{children:[c?r(j,{title:`${s.title} (${s.list.length})`}):null,r("ul",{className:"order-order-product-list-content__items",children:(v=s.list)==null?void 0:v.map(O=>r("li",{"data-testid":"order-product-list-content-item",children:r(ee,{loading:u,product:O,itemType:s.type,taxConfig:e,translations:m,showConfigurableOptions:i})},O.id))})]},a)})}):r(U,{})},ee=({loading:u,product:e,itemType:d,taxConfig:c,translations:i,showConfigurableOptions:m})=>{var S,C,N,x,Q,_,H,V,$,M;const{taxExcluded:h,taxIncluded:s}=c,a=A((y,F,G)=>r(W,{amount:y,currency:F,weight:"normal",...G}),[]);let v={};const O=d==="cancelled",D=(C=(S=e==null?void 0:e.product)==null?void 0:S.stockStatus)==null?void 0:C.includes("IN_STOCK"),t=(e==null?void 0:e.giftCard)||{},l=(N=e==null?void 0:e.itemPrices)==null?void 0:N.priceIncludingTax,n=(x=e==null?void 0:e.itemPrices)==null?void 0:x.originalPrice,o=(Q=e==null?void 0:e.itemPrices)==null?void 0:Q.price,f=e.discounted&&((_=e.price)==null?void 0:_.value)!==(n==null?void 0:n.value)*(e==null?void 0:e.totalQuantity),w={..."configurableOptions"in e?e.configurableOptions:{},..."bundleOptions"in e?e.bundleOptions:{},..."senderName"in t&&(t!=null&&t.senderName)?{[i.sender]:t==null?void 0:t.senderName}:{},..."senderEmail"in t&&(t!=null&&t.senderEmail)?{[i.sender]:t==null?void 0:t.senderEmail}:{},..."recipientName"in t&&(t!=null&&t.recipientName)?{[i.recipient]:t==null?void 0:t.recipientName}:{},..."recipientEmail"in t&&(t!=null&&t.recipientEmail)?{[i.recipient]:t==null?void 0:t.recipientEmail}:{},..."message"in t&&(t!=null&&t.message)?{[i.message]:t==null?void 0:t.message}:{},..."downloadableLinks"in e&&(e!=null&&e.downloadableLinks)?{[`${(H=e==null?void 0:e.downloadableLinks)==null?void 0:H.count} ${i.downloadableCount}`]:(V=e==null?void 0:e.downloadableLinks)==null?void 0:V.result}:{}};if(s&&h){const y=f?n==null?void 0:n.value:(l==null?void 0:l.value)*(e==null?void 0:e.totalQuantity);v={taxExcluded:!0,taxIncluded:void 0,price:a(n==null?void 0:n.value,n==null?void 0:n.currency),total:k(E,{children:[a(y,n==null?void 0:n.currency,{variant:e.discounted&&(l==null?void 0:l.value)!==y?"strikethrough":"default"}),e.discounted&&(l==null?void 0:l.value)!==y?a(l==null?void 0:l.value,l==null?void 0:l.currency,{sale:!0,weight:"bold"}):null]}),totalExcludingTax:a((o==null?void 0:o.value)*e.totalQuantity,o==null?void 0:o.currency)}}else if(!s&&h)v={taxExcluded:void 0,taxIncluded:void 0,price:a(n==null?void 0:n.value,n==null?void 0:n.currency),total:k(E,{children:[a((n==null?void 0:n.value)*(e==null?void 0:e.totalQuantity),l==null?void 0:l.currency,{variant:f?"strikethrough":"default"}),f?a(($=e.price)==null?void 0:$.value,(M=e.price)==null?void 0:M.currency,{sale:!0,weight:"bold"}):null]}),totalExcludingTax:a((o==null?void 0:o.value)*(e==null?void 0:e.totalQuantity),o==null?void 0:o.currency)};else if(s&&!h){const y=f?n.value:l.value*e.totalQuantity;v={taxExcluded:void 0,taxIncluded:!0,price:a(l==null?void 0:l.value,l==null?void 0:l.currency),total:k(E,{children:[a(y,l==null?void 0:l.currency,{variant:f?"strikethrough":"default",weight:"bold"}),f?a(l==null?void 0:l.value,l==null?void 0:l.currency,{sale:!0,weight:"bold"}):null]})}}return r(z,{loading:u,alert:O&&D?k("span",{children:[r(B,{source:T}),i.outOfStock]}):r(E,{}),configurations:(m==null?void 0:m(w))??w,title:r("div",{"data-testid":"product-name",className:q(["cart-summary-item__title",["cart-summary-item__title--strikethrough",O]]),children:e.product.name}),sku:r("div",{children:e.product.sku}),quantity:e.totalQuantity,image:r(K,{src:e.product.thumbnail.url,alt:e.product.thumbnail.label,loading:"lazy",width:"90",height:"120"}),...v})},te=({orderData:u})=>{const[e,d]=b(!0),[c,i]=b(u),[m,h]=b({taxIncluded:!1,taxExcluded:!1});return P(()=>{I().then(s=>{s&&h(g(s==null?void 0:s.shoppingCartDisplayPrice))}).finally(()=>{d(!1)})},[]),P(()=>{const s=X.on("order/data",a=>{i(a)},{eager:!0});return()=>{s==null||s.off()}},[]),{loading:e,taxConfig:m,order:c}},ye=({className:u,orderData:e,withHeader:d,showConfigurableOptions:c})=>{const{loading:i,taxConfig:m,order:h}=te({orderData:e});return r("div",{className:q(["order-order-product-list",u]),children:r(p,{loading:i,taxConfig:m,order:h,withHeader:d,showConfigurableOptions:c})})};export{ye as OrderProductList,ye as default};
