import{jsx as r,jsxs as b,Fragment as w}from"@dropins/tools/preact-jsx-runtime.js";import{Card as U,Header as X,Price as Y,CartItem as g,Icon as I,Image as K}from"@dropins/tools/components.js";import"../chunks/OrderCancelReasonsForm.js";import{u as T}from"../chunks/ReturnOrder.js";import{classes as N}from"@dropins/tools/lib.js";import{useState as C,useEffect as A,useMemo as p,useCallback as ee}from"@dropins/tools/preact-hooks.js";import{events as te}from"@dropins/tools/event-bus.js";import{s as ne}from"../chunks/setTaxStatus.js";import{g as le}from"../chunks/getStoreConfig.js";import*as c from"@dropins/tools/preact-compat.js";import{Fragment as ae}from"@dropins/tools/preact.js";import{O as se}from"../chunks/OrderLoaders.js";import{useText as re}from"@dropins/tools/i18n.js";import"../chunks/fetch-graphql.js";import"@dropins/tools/fetch-graphql.js";const ie=v=>c.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...v},c.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M0.75 12C0.75 5.78421 5.78421 0.75 12 0.75C18.2158 0.75 23.25 5.78421 23.25 12C23.25 18.2158 18.2158 23.25 12 23.25C5.78421 23.25 0.75 18.2158 0.75 12Z",stroke:"currentColor"}),c.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.75 5.88423V4.75H12.25V5.88423L12.0485 13.0713H11.9515L11.75 5.88423ZM11.7994 18.25V16.9868H12.2253V18.25H11.7994Z",stroke:"currentColor"})),me=({orderData:v})=>{const[e,y]=C(!0),[d,i]=C(v),[O,m]=C({taxIncluded:!1,taxExcluded:!1});return A(()=>{le().then(a=>{a&&m(ne(a==null?void 0:a.shoppingCartDisplayPrice))}).finally(()=>{y(!1)})},[]),A(()=>{const a=te.on("order/data",u=>{i(u)},{eager:!0});return()=>{a==null||a.off()}},[]),{loading:e,taxConfig:O,order:d}},oe=({loading:v,taxConfig:e,order:y=null,withHeader:d=!0,showConfigurableOptions:i,routeProductDetails:O})=>{const m=T(),a=re({cancelled:"Order.OrderProductListContent.cancelledTitle",allOrders:m?"Order.OrderProductListContent.allReturnOrdersTitle":"Order.OrderProductListContent.allOrdersTitle",returned:"Order.OrderProductListContent.Returned",sender:"Order.OrderProductListContent.GiftCard.sender",recipient:"Order.OrderProductListContent.GiftCard.recipient",message:"Order.OrderProductListContent.GiftCard.message",outOfStock:"Order.OrderProductListContent.stockStatus.outOfStock",downloadableCount:"Order.OrderProductListContent.downloadableCount"}),u=p(()=>{if(!y)return[];const s=m?y.returns[0]:y,{items:f}=s;return[{type:"returned",list:f.filter(o=>o.quantityReturned),title:a.returned},{type:"cancelled",list:f.filter(o=>o.quantityCanceled),title:a.cancelled},{type:"",list:f.filter(o=>!o.quantityCanceled),title:a.allOrders}]},[y,m,a]);return y?r(U,{variant:"secondary",className:"order-order-product-list-content",children:u.filter(s=>s.list.length).map((s,f)=>{var o;return b(ae,{children:[d?r(X,{title:`${s.title} (${s.list.length})`}):null,r("ul",{className:"order-order-product-list-content__items",children:(o=s.list)==null?void 0:o.map(E=>r("li",{"data-testid":"order-product-list-content-item",children:r(he,{loading:v,product:E,itemType:s.type,taxConfig:e,translations:a,showConfigurableOptions:i,routeProductDetails:O})},E.id))})]},f)})}):r(se,{})},he=({loading:v,product:e,itemType:y,taxConfig:d,translations:i,showConfigurableOptions:O,routeProductDetails:m})=>{var _,x,Q,H,R,V,$,q,M,F,G,P,Z,j,z,W,B;const{taxExcluded:a,taxIncluded:u}=d,s=ee((k,D,J)=>r(Y,{amount:k,currency:D,weight:"normal",...J}),[]);let f={};const o=y==="cancelled",E=(x=(_=e==null?void 0:e.product)==null?void 0:_.stockStatus)==null?void 0:x.includes("IN_STOCK"),t=(e==null?void 0:e.giftCard)||{},n=(Q=e==null?void 0:e.itemPrices)==null?void 0:Q.priceIncludingTax,l=(H=e==null?void 0:e.itemPrices)==null?void 0:H.originalPrice,h=(R=e==null?void 0:e.itemPrices)==null?void 0:R.price,L=e.discounted&&((V=e.price)==null?void 0:V.value)!==(l==null?void 0:l.value)*(e==null?void 0:e.totalQuantity),S={..."configurableOptions"in e?e.configurableOptions:{},..."bundleOptions"in e?e.bundleOptions:{},..."senderName"in t&&(t!=null&&t.senderName)?{[i.sender]:t==null?void 0:t.senderName}:{},..."senderEmail"in t&&(t!=null&&t.senderEmail)?{[i.sender]:t==null?void 0:t.senderEmail}:{},..."recipientName"in t&&(t!=null&&t.recipientName)?{[i.recipient]:t==null?void 0:t.recipientName}:{},..."recipientEmail"in t&&(t!=null&&t.recipientEmail)?{[i.recipient]:t==null?void 0:t.recipientEmail}:{},..."message"in t&&(t!=null&&t.message)?{[i.message]:t==null?void 0:t.message}:{},..."downloadableLinks"in e&&(e!=null&&e.downloadableLinks)?{[`${($=e==null?void 0:e.downloadableLinks)==null?void 0:$.count} ${i.downloadableCount}`]:(q=e==null?void 0:e.downloadableLinks)==null?void 0:q.result}:{}};if(u&&a){const k=L?l==null?void 0:l.value:(n==null?void 0:n.value)*(e==null?void 0:e.totalQuantity);f={taxExcluded:!0,taxIncluded:void 0,price:s(l==null?void 0:l.value,l==null?void 0:l.currency),total:b(w,{children:[s(k,l==null?void 0:l.currency,{variant:e.discounted&&(n==null?void 0:n.value)!==k?"strikethrough":"default"}),e.discounted&&(n==null?void 0:n.value)!==k?s(n==null?void 0:n.value,n==null?void 0:n.currency,{sale:!0,weight:"bold"}):null]}),totalExcludingTax:s((h==null?void 0:h.value)*e.totalQuantity,h==null?void 0:h.currency)}}else if(!u&&a)f={taxExcluded:void 0,taxIncluded:void 0,price:s(l==null?void 0:l.value,l==null?void 0:l.currency),total:b(w,{children:[s((l==null?void 0:l.value)*(e==null?void 0:e.totalQuantity),n==null?void 0:n.currency,{variant:L?"strikethrough":"default"}),L?s((M=e.price)==null?void 0:M.value,(F=e.price)==null?void 0:F.currency,{sale:!0,weight:"bold"}):null]}),totalExcludingTax:s((h==null?void 0:h.value)*(e==null?void 0:e.totalQuantity),h==null?void 0:h.currency)};else if(u&&!a){const k=L?l.value:n.value*e.totalQuantity;f={taxExcluded:void 0,taxIncluded:!0,price:s(n==null?void 0:n.value,n==null?void 0:n.currency),total:b(w,{children:[s(k,n==null?void 0:n.currency,{variant:L?"strikethrough":"default",weight:"bold"}),L?s(n==null?void 0:n.value,n==null?void 0:n.currency,{sale:!0,weight:"bold"}):null]})}}return r(g,{loading:v,alert:o&&E?b("span",{children:[r(I,{source:ie}),i.outOfStock]}):r(w,{}),configurations:(O==null?void 0:O(S))??S,title:m?r("a",{"data-testid":"product-name",className:N(["cart-summary-item__title",["cart-summary-item__title--strikethrough",o]]),href:m(e),children:(G=e==null?void 0:e.product)==null?void 0:G.name}):r("div",{"data-testid":"product-name",className:N(["cart-summary-item__title",["cart-summary-item__title--strikethrough",o]]),children:(P=e==null?void 0:e.product)==null?void 0:P.name}),sku:r("div",{children:(Z=e==null?void 0:e.product)==null?void 0:Z.sku}),quantity:e.totalQuantity,image:m?r("a",{href:m(e),children:r(K,{src:(j=e==null?void 0:e.product)==null?void 0:j.thumbnail.url,alt:(z=e==null?void 0:e.product)==null?void 0:z.thumbnail.label,loading:"lazy",width:"90",height:"120"})}):r(K,{src:(W=e==null?void 0:e.product)==null?void 0:W.thumbnail.url,alt:(B=e==null?void 0:e.product)==null?void 0:B.thumbnail.label,loading:"lazy",width:"90",height:"120"}),...f})},Se=({className:v,orderData:e,withHeader:y,showConfigurableOptions:d,routeProductDetails:i})=>{const{loading:O,taxConfig:m,order:a}=me({orderData:e});return r("div",{className:N(["order-order-product-list",v]),children:r(oe,{loading:O,taxConfig:m,order:a,withHeader:y,showConfigurableOptions:d,routeProductDetails:i})})};export{Se as OrderProductList,Se as default};
